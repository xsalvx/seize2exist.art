const fs = require('fs');
const path = require('path');
const { promisify } = require('util');

const writeFile = promisify(fs.writeFile);
const notesFilePath = path.resolve(__dirname, '..', 'notes.json'); // Path to the notes file

// Save note and image
exports.handler = async (event, context) => {
    if (event.httpMethod === "POST") {
        // Parse the form data
        const formData = new URLSearchParams(event.body);
        const noteText = formData.get('noteText');

        if (!noteText) {
            return { statusCode: 400, body: JSON.stringify({ message: "Note text is required" }) };
        }

        const newNote = { text: noteText, image: null };

        // Store the note in the 'notes.json' file
        const existingNotes = JSON.parse(await promisify(fs.readFile)(notesFilePath, 'utf-8'));
        existingNotes.push(newNote);

        await writeFile(notesFilePath, JSON.stringify(existingNotes));

        return {
            statusCode: 200,
            body: JSON.stringify({ message: "Note saved successfully!" })
        };
    }

    return { statusCode: 405, body: JSON.stringify({ message: "Method not allowed" }) };
};
